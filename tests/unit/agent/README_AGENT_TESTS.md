# Agentæ¨¡å—æµ‹è¯•å¥—ä»¶

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„Agentæ¨¡å—æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…å«åŸºç¡€åŠŸèƒ½æµ‹è¯•ã€æ¥å£æµ‹è¯•å’Œå…·ä½“Agentå®ç°æµ‹è¯•ï¼Œç¡®ä¿Agentç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

## ğŸ“‹ æµ‹è¯•æ¦‚è§ˆ

### æµ‹è¯•æ–‡ä»¶ç»“æ„

**test_helpers.py** - æµ‹è¯•è¾…åŠ©å·¥å…·å’ŒMockç±»
**test_interface.py** - Agentæ¥å£æµ‹è¯• (8ä¸ªæµ‹è¯•)
**test_base_agent.py** - BaseAgentæ ¸å¿ƒåŠŸèƒ½æµ‹è¯• (15ä¸ªæµ‹è¯•)
**test_simple.py** - ReAct Agentæµ‹è¯• (10ä¸ªæµ‹è¯•) [åŸSimple Agent]
**test_react.py** - Reflect Agentæµ‹è¯• (12ä¸ªæµ‹è¯•) [åŸReAct Agent]

**æ€»è®¡**: 45ä¸ªæµ‹è¯•ï¼Œé¢„è®¡è¦†ç›–ç‡80%+

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### æ ¸å¿ƒç»„ä»¶æµ‹è¯•
- **test_interface.py**: IAgentæ¥å£å®šä¹‰å’Œå¥‘çº¦æµ‹è¯•
- **test_base_agent.py**: BaseAgentå®ç°å’Œæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
- **test_helpers.py**: æµ‹è¯•è¾…åŠ©å·¥å…·å’ŒMockå¯¹è±¡éªŒè¯

#### æµ‹è¯•é‡ç‚¹
- **æ¥å£å¥‘çº¦**: éªŒè¯IAgentæ¥å£çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§
- **BaseAgentåŠŸèƒ½**: æµ‹è¯•AgentåŸºç¡€å®ç°çš„æ‰€æœ‰æ ¸å¿ƒæ–¹æ³•
- **ç±»å‹å®‰å…¨**: éªŒè¯æ³›å‹ç±»å‹çº¦æŸå’Œç±»å‹æ³¨è§£
- **é’©å­ç³»ç»Ÿ**: æµ‹è¯•å®Œæ•´çš„é’©å­å‡½æ•°æœºåˆ¶
- **å¼‚æ­¥æ”¯æŒ**: éªŒè¯å¼‚æ­¥æ–¹æ³•çš„æ­£ç¡®å®ç°

### 2. Agentå®ç°æµ‹è¯•

#### ReAct Agentæµ‹è¯• (test_simple.py) [åŸSimple Agent]
- **end_workflowå‡½æ•°**: å·¥ä½œæµç»“æŸæœºåˆ¶æµ‹è¯•
- **çŠ¶æ€è½¬æ¢**: ReActå·¥ä½œæµçŠ¶æ€è½¬æ¢è§„åˆ™æµ‹è¯• (PROCESSING -> COMPLETED)
- **å·¥å…·è°ƒç”¨**: å·¥å…·è°ƒç”¨å’Œæ ‡ç­¾éªŒè¯æµ‹è¯•
- **Agentæ„å»º**: build_react_agentå‡½æ•°æµ‹è¯•

#### Reflect Agentæµ‹è¯• (test_react.py) [åŸReAct Agent]
- **Reflectå¾ªç¯**: Reason-Reflect-Reasonå¾ªç¯æµ‹è¯•
- **çŠ¶æ€ç®¡ç†**: Reflectå·¥ä½œæµçŠ¶æ€è½¬æ¢æµ‹è¯• (REASONING -> REFLECTING -> FINISHED)
- **å·¥å…·é›†æˆ**: å·¥å…·è°ƒç”¨å’Œå·¥ä½œæµé›†æˆæµ‹è¯•
- **è‡ªå®šä¹‰é…ç½®**: å¯é…ç½®Agentæ„å»ºæµ‹è¯•

### 3. æµ‹è¯•è®¾è®¡æ¨¡å¼å±•ç¤º

#### Mockæ¨¡å¼
- **MockLLM**: æ¨¡æ‹Ÿè¯­è¨€å®ç°ï¼Œæ”¯æŒæˆåŠŸ/å¤±è´¥åœºæ™¯
- **MockTask**: æ¨¡æ‹Ÿä»»åŠ¡å®ç°ï¼Œæ”¯æŒçŠ¶æ€è½¬æ¢
- **MockWorkflow**: æ¨¡æ‹Ÿå·¥ä½œæµå®ç°
- **MockQueue**: æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—å®ç°

#### å¼‚æ­¥æµ‹è¯•æ¨¡å¼
- **async/awaitæ”¯æŒ**: å®Œæ•´çš„å¼‚æ­¥æµ‹è¯•æ”¯æŒ
- **è¶…æ—¶æ§åˆ¶**: æµ‹è¯•è¶…æ—¶ä¿æŠ¤æœºåˆ¶
- **å¹¶å‘æµ‹è¯•**: é’©å­å‡½æ•°å¹¶å‘æ‰§è¡Œæµ‹è¯•

#### ç±»å‹å®‰å…¨æµ‹è¯•
- **æ³›å‹çº¦æŸ**: TypeVarå’ŒGenericç±»å‹æµ‹è¯•
- **æ¥å£éªŒè¯**: Protocolæ¥å£å®ç°éªŒè¯
- **ç±»å‹æ³¨è§£**: å®Œæ•´çš„ç±»å‹æ³¨è§£è¦†ç›–ç‡æµ‹è¯•

### 4. æµ‹è¯•è„šæœ¬è®¾è®¡

#### åŒé‡è„šæœ¬æ”¯æŒ
- **run_agent_tests.sh**: Shellç‰ˆæœ¬ï¼ˆLinux/Mac/WSLï¼‰
- **run_agent_tests.py**: Pythonç‰ˆæœ¬ï¼ˆè·¨å¹³å°ï¼‰

#### è„šæœ¬åŠŸèƒ½
- **ç¯å¢ƒæ™ºèƒ½æ£€æµ‹**: uvå’Œç³»ç»ŸPythonç¯å¢ƒè‡ªåŠ¨æ£€æµ‹
- **æµ‹è¯•åˆ†ç±»æ‰§è¡Œ**: åŸºç¡€/æ¥å£/Simple/ReActåˆ†ç±»æµ‹è¯•
- **ä»£ç è´¨é‡æ£€æŸ¥**: é›†æˆpyrightå’Œpylintæ£€æŸ¥
- **è¦†ç›–ç‡æŠ¥å‘Š**: HTMLå’ŒXMLæ ¼å¼è¦†ç›–ç‡ç”Ÿæˆ
- **è¯¦ç»†æ—¥å¿—**: å½©è‰²è¾“å‡ºå’Œè¯¦ç»†é”™è¯¯è¯Šæ–­

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.12+
- uv (æ¨è) æˆ– python3/pytest
- pyright (ç”¨äºç±»å‹æ£€æŸ¥)
- pylint (ç”¨äºä»£ç é£æ ¼æ£€æŸ¥)

### è¿è¡Œæµ‹è¯•

#### ä½¿ç”¨Shellè„šæœ¬ (æ¨è)
```bash
# è¿è¡Œæ‰€æœ‰Agentæµ‹è¯•
./run_agent_tests.sh all

# è¿è¡ŒåŸºç¡€åŠŸèƒ½æµ‹è¯•
./run_agent_tests.sh basic

# è¿è¡Œç‰¹å®šAgentæµ‹è¯•
./run_agent_tests.sh simple
./run_agent_tests.sh react

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
./run_agent_tests.sh coverage

# è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥
./run_agent_tests.sh quality

# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
./run_agent_tests.sh help
```

#### ä½¿ç”¨Pythonè„šæœ¬ (è·¨å¹³å°)
```bash
# è¿è¡Œæ‰€æœ‰Agentæµ‹è¯•
python run_agent_tests.py all

# è¯¦ç»†è¾“å‡ºæ¨¡å¼
python run_agent_tests.py all -v

# ä¿ç•™è¦†ç›–ç‡æ–‡ä»¶
python run_agent_tests.py coverage --keep

# è¿è¡Œè´¨é‡æ£€æŸ¥
python run_agent_tests.py quality

# æŸ¥çœ‹å¸®åŠ©
python run_agent_tests.py help
```

### ç›´æ¥ä½¿ç”¨pytest (å¼€å‘è°ƒè¯•)
```bash
# è¿è¡Œæ‰€æœ‰Agentæµ‹è¯•
uv run pytest tests/agent/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
uv run pytest tests/agent/test_base_agent.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
uv run pytest tests/agent/ --cov=src.core.agent --cov-report=term-missing
```

## ğŸ“Š æµ‹è¯•åˆ†ç±»è¯¦è§£

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯• (basic)

#### test_interface.py
- **æ¥å£æŠ½è±¡æ€§éªŒè¯**: ç¡®ä¿IAgentæ˜¯æ­£ç¡®çš„æŠ½è±¡åŸºç±»
- **æ–¹æ³•ç­¾åæ£€æŸ¥**: éªŒè¯æ‰€æœ‰å¿…éœ€æ–¹æ³•çš„å­˜åœ¨å’Œç­¾å
- **æ³›å‹ç±»å‹æµ‹è¯•**: æµ‹è¯•æ³›å‹ç±»å‹å‚æ•°çš„æ­£ç¡®ä½¿ç”¨
- **æ–‡æ¡£å®Œæ•´æ€§**: éªŒè¯æ¥å£å’Œæ–¹æ³•çš„æ–‡æ¡£å­—ç¬¦ä¸²

#### test_base_agent.py
- **åŸºç¡€ä¿¡æ¯ç®¡ç†**: IDã€åç§°ã€ç±»å‹ç®¡ç†æµ‹è¯•
- **è¯­è¨€æ¨¡å‹ç®¡ç†**: LLMè·å–å’Œè®¾ç½®æµ‹è¯•
- **å·¥ä½œæµé›†æˆ**: Workflowå…³è”å’Œæ“ä½œæµ‹è¯•
- **å·¥å…·è°ƒç”¨æœºåˆ¶**: å·¥å…·è°ƒç”¨å’Œå‚æ•°å¤„ç†æµ‹è¯•
- **ä»»åŠ¡æ‰§è¡Œæµç¨‹**: å®Œæ•´çš„ä»»åŠ¡æµæ‰§è¡Œæµ‹è¯•
- **é’©å­ç³»ç»Ÿ**: å®Œæ•´çš„é’©å­å‡½æ•°ç³»ç»Ÿæµ‹è¯•
- **è§‚å¯Ÿ-æ€è€ƒ-è¡ŒåŠ¨å¾ªç¯**: æ ¸å¿ƒAgentå¾ªç¯æµ‹è¯•

### 2. Simple Agentæµ‹è¯• (simple)

#### å·¥ä½œæµç®¡ç†
- **end_workflowå‡½æ•°**: å·¥ä½œæµç»“æŸå’Œè¾“å‡ºæå–æµ‹è¯•
- **çŠ¶æ€è½¬æ¢**: Simpleå·¥ä½œæµçŠ¶æ€è½¬æ¢è§„åˆ™æµ‹è¯•
- **äº‹ä»¶é“¾**: äº‹ä»¶é“¾æ‰§è¡Œé¡ºåºæµ‹è¯•

#### Agentæ„å»º
- **build_simple_agentå‡½æ•°**: Agentæ„å»ºå’Œé…ç½®æµ‹è¯•
- **ä¾èµ–æ³¨å…¥**: LLMå’Œå·¥ä½œæµä¾èµ–æ³¨å…¥æµ‹è¯•
- **é”™è¯¯å¤„ç†**: é…ç½®é”™è¯¯å’Œå¼‚å¸¸å¤„ç†æµ‹è¯•

### 3. ReAct Agentæµ‹è¯• (react)

#### ReActå¾ªç¯
- **Reasoningé˜¶æ®µ**: æ¨ç†é˜¶æ®µåŠŸèƒ½æµ‹è¯•
- **Reflectingé˜¶æ®µ**: åæ€é˜¶æ®µåŠŸèƒ½æµ‹è¯•
- **çŠ¶æ€è½¬æ¢**: ReActå·¥ä½œæµçŠ¶æ€è½¬æ¢æµ‹è¯•

#### é«˜çº§åŠŸèƒ½
- **è‡ªå®šä¹‰é…ç½®**: å¯é…ç½®Agentå‚æ•°æµ‹è¯•
- **å·¥å…·é›†æˆ**: å·¥å…·è°ƒç”¨å’Œé›†æˆæµ‹è¯•
- **é”™è¯¯æ¢å¤**: ReActå¾ªç¯é”™è¯¯å¤„ç†æµ‹è¯•

## ğŸ”§ æµ‹è¯•å·¥å…·å’ŒMock

### MockLLMç±»
```python
# åˆ›å»ºæ¨¡æ‹Ÿè¯­è¨€æ¨¡å‹
mock_llm = MockLLM(
    model_name="test-model",
    response_content="Test response",
    should_fail=False  # è®¾ç½®ä¸ºTrueæ¨¡æ‹Ÿé”™è¯¯
)
```

### MockTaskç±»
```python
# åˆ›å»ºæ¨¡æ‹Ÿä»»åŠ¡
task = MockTask(
    initial_state="PROCESSING",
    valid_states={"PROCESSING", "COMPLETED"},
    task_id="test-task"
)
```

### AgentTestMixinæ··å…¥ç±»
```python
class MyTest(unittest.TestCase, AgentTestMixin):
    def setUp(self):
        self.mock_llm = self.create_mock_llm()
        self.task = self.create_mock_task("PROCESSING", {"PROCESSING", "COMPLETED"})
        self.workflow = self.create_mock_workflow("PROCESSING")
```

## ğŸ“ˆ è¦†ç›–ç‡è¦æ±‚

### è¦†ç›–ç‡ç›®æ ‡
- **æ•´ä½“è¦†ç›–ç‡**: â‰¥80%
- **åˆ†æ”¯è¦†ç›–ç‡**: â‰¥75%
- **æ¥å£è¦†ç›–ç‡**: 100% (æ‰€æœ‰æ¥å£æ–¹æ³•)

### è¦†ç›–ç‡æŠ¥å‘Š
```bash
# ç”Ÿæˆè¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
./run_agent_tests.sh coverage --keep

# æŸ¥çœ‹HTMLæŠ¥å‘Š
open htmlcov/index.html  # macOS
xdg-open htmlcov/index.html  # Linux
```

## ğŸ” ä»£ç è´¨é‡æ£€æŸ¥

### è´¨é‡æ£€æŸ¥æ ‡å‡†
- **pyright**: é›¶é”™è¯¯ï¼Œé›¶è­¦å‘Š
- **pylint**: è¯„åˆ†â‰¥8.0/10
- **ç±»å‹æ³¨è§£**: 100%è¦†ç›–ç‡
- **æ–‡æ¡£å­—ç¬¦ä¸²**: æ‰€æœ‰å…¬å…±æ–¹æ³•

### è¿è¡Œè´¨é‡æ£€æŸ¥
```bash
# è¿è¡Œå®Œæ•´è´¨é‡æ£€æŸ¥
./run_agent_tests.sh quality

# å•ç‹¬è¿è¡Œç±»å‹æ£€æŸ¥
uv run pyright tasking/core/agent/

# å•ç‹¬è¿è¡Œä»£ç é£æ ¼æ£€æŸ¥
uv run pylint tasking/core/agent/
```

## ğŸš¨ é”™è¯¯æ’æŸ¥æŒ‡å—

### å¸¸è§é—®é¢˜

#### 1. ç¯å¢ƒé—®é¢˜
**é—®é¢˜**: æ‰¾ä¸åˆ°Pythonç¯å¢ƒ
**è§£å†³**:
```bash
# å®‰è£…uv (æ¨è)
pip install uv

# æˆ–ç¡®ä¿python3å¯ç”¨
python3 --version
```

#### 2. ä¾èµ–é—®é¢˜
**é—®é¢˜**: æµ‹è¯•ä¾èµ–ç¼ºå¤±
**è§£å†³**:
```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
./run_agent_tests.sh install

# æˆ–æ‰‹åŠ¨å®‰è£…
uv run pip install pytest pytest-cov pytest-asyncio
```

#### 3. å¯¼å…¥é”™è¯¯
**é—®é¢˜**: æ¨¡å—å¯¼å…¥å¤±è´¥
**è§£å†³**:
- ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œæµ‹è¯•
- æ£€æŸ¥PYTHONPATHè®¾ç½®
- ä½¿ç”¨uv run pythonæ‰§è¡Œ

#### 4. ç±»å‹æ£€æŸ¥é”™è¯¯
**é—®é¢˜**: pyrightæ£€æŸ¥å¤±è´¥
**è§£å†³**:
- æ£€æŸ¥ç±»å‹æ³¨è§£çš„å®Œæ•´æ€§
- ç¡®ä¿æ³›å‹ç±»å‹å‚æ•°æ­£ç¡®
- æŸ¥çœ‹å…·ä½“çš„ç±»å‹é”™è¯¯ä¿¡æ¯

#### 5. å¼‚æ­¥æµ‹è¯•è¶…æ—¶
**é—®é¢˜**: å¼‚æ­¥æµ‹è¯•è¶…æ—¶å¤±è´¥
**è§£å†³**:
- æ£€æŸ¥Mockå¯¹è±¡çš„å¼‚æ­¥æ–¹æ³•å®ç°
- ç¡®ä¿async/awaitè¯­æ³•æ­£ç¡®
- è°ƒæ•´æµ‹è¯•è¶…æ—¶æ—¶é—´

### è°ƒè¯•æŠ€å·§

#### 1. è¯¦ç»†è¾“å‡º
```bash
# å¯ç”¨è¯¦ç»†è¾“å‡º
./run_agent_tests.sh all -v

# Pythonè„šæœ¬è¯¦ç»†è¾“å‡º
python run_agent_tests.py all --verbose
```

#### 2. å•ç‹¬è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
./run_agent_tests.sh base_agent

# ä½¿ç”¨pytestè¿è¡Œå•ä¸ªæµ‹è¯•
uv run pytest tests/agent/test_base_agent.py::TestBaseAgent::test_agent_basic_info -v
```

#### 3. ä¿ç•™ä¸´æ—¶æ–‡ä»¶
```bash
# ä¿ç•™æµ‹è¯•è¾“å‡ºæ–‡ä»¶ç”¨äºè°ƒè¯•
./run_agent_tests.sh coverage --keep

# æŸ¥çœ‹pytestç¼“å­˜
ls -la .pytest_cache/
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç¼–å†™
- ä½¿ç”¨Mockå¯¹è±¡éš”ç¦»å¤–éƒ¨ä¾èµ–
- æ¯ä¸ªæµ‹è¯•ä¸“æ³¨å•ä¸€åŠŸèƒ½ç‚¹
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- åŒ…å«æ­£å¸¸å’Œå¼‚å¸¸åœºæ™¯æµ‹è¯•

### 2. å¼‚æ­¥æµ‹è¯•
- ä½¿ç”¨`asyncio.wait_for`é˜²æ­¢æµ‹è¯•å¡æ­»
- æ­£ç¡®å¤„ç†async/awaitè¯­æ³•
- æµ‹è¯•å¹¶å‘å’Œä¸²è¡Œæ‰§è¡Œåœºæ™¯

### 3. ç±»å‹å®‰å…¨
- ä¸ºæ‰€æœ‰Mockå¯¹è±¡æ·»åŠ ç±»å‹æ³¨è§£
- ä½¿ç”¨TypeVarå’ŒGenericä¿æŒç±»å‹ä¸€è‡´æ€§
- éªŒè¯æ¥å£å®ç°çš„ç±»å‹æ­£ç¡®æ€§

### 4. æŒç»­é›†æˆ
- æ‰€æœ‰ä»£ç ç¼–è¾‘åå¿…é¡»é€šè¿‡è´¨é‡æ£€æŸ¥
- ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°ç›®æ ‡è¦æ±‚
- å®šæœŸè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•
1. åœ¨ç›¸åº”çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•
2. ä½¿ç”¨AgentTestMixinæä¾›çš„å·¥å…·å‡½æ•°
3. ç¡®ä¿æµ‹è¯•å…·æœ‰æ¸…æ™°çš„æ–­è¨€å’Œé”™è¯¯æ¶ˆæ¯
4. æ›´æ–°æ­¤READMEæ–‡æ¡£

### ä¿®æ”¹ç°æœ‰æµ‹è¯•
1. ä¿æŒå‘åå…¼å®¹æ€§
2. æ›´æ–°ç›¸å…³çš„Mockå¯¹è±¡
3. ç¡®ä¿æ‰€æœ‰ç›¸å…³æµ‹è¯•ä»ç„¶é€šè¿‡
4. æ›´æ–°æ–‡æ¡£è¯´æ˜

### æ€§èƒ½è€ƒè™‘
- é¿å…ä¸å¿…è¦çš„ç½‘ç»œè°ƒç”¨
- ä½¿ç”¨è½»é‡çº§Mockå¯¹è±¡
- æ§åˆ¶æµ‹è¯•æ‰§è¡Œæ—¶é—´
- ä¼˜åŒ–å¼‚æ­¥æµ‹è¯•æ€§èƒ½

---

**Agentæµ‹è¯•å¥—ä»¶éµå¾ªé¡¹ç›®çš„MVPåŸåˆ™å’Œå¥¥å¡å§†å‰ƒåˆ€åŸåˆ™ï¼Œä¸“æ³¨äºæ ¸å¿ƒåŠŸèƒ½éªŒè¯ï¼Œç¡®ä¿Agentç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚**