# æµ‹è¯•æ€»è§ˆ

æœ¬ç›®å½•åŒ…å«äº†é¡¹ç›®çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œä»£ç è´¨é‡æ£€æŸ¥ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ README.md                    # æœ¬æ–‡ä»¶ - æµ‹è¯•æ€»è§ˆ
â”œâ”€â”€ run_tests.py                 # Pythonç‰ˆæœ¬çš„æµ‹è¯•è¿è¡Œè„šæœ¬
â”œâ”€â”€ run_tests.sh                 # Shellç‰ˆæœ¬çš„æµ‹è¯•è¿è¡Œè„šæœ¬
â”œâ”€â”€ test_settings_agents.py      # ç‰¹å®šè®¾ç½®æµ‹è¯•
â”‚
â”œâ”€â”€ unit/                        # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ agent/                   # agentæ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒæ¨¡å—æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ context/             # ä¸Šä¸‹æ–‡æ¨¡å—æµ‹è¯•
â”‚   â”‚   â””â”€â”€ middleware/          # ä¸­é—´ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ database/                # æ•°æ®åº“æ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ llm/                     # LLMæ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ model/                   # æ¨¡å‹æ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ scheduler/               # è°ƒåº¦å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ state_machine/           # çŠ¶æ€æœºæµ‹è¯•
â”‚   â””â”€â”€ terminal/                # ç»ˆç«¯æ¨¡å—æµ‹è¯•
â”‚
â”œâ”€â”€ integration/                 # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ database/                # æ•°æ®åº“é›†æˆæµ‹è¯•
â”‚       â”œâ”€â”€ test_milvus_memory.py    # Milvusæ•°æ®åº“æµ‹è¯•
â”‚       â”œâ”€â”€ test_sqlite_database.py  # SQLiteæ•°æ®åº“æµ‹è¯•ï¼ˆæ–°å¢ï¼‰
â”‚       â””â”€â”€ test_sqlite_memory.py    # SQLiteå†…å­˜æµ‹è¯•
â”‚
â””â”€â”€ unit/                        # å•å…ƒæµ‹è¯•å‰¯æœ¬ï¼ˆç”¨äºå¤‡ä»½ï¼‰
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
# ä½¿ç”¨Shellè„šæœ¬
./tests/run_tests.sh all

# æˆ–ä½¿ç”¨Pythonè„šæœ¬
uv run python tests/run_tests.py all
```

### è¿è¡Œç‰¹å®šç±»å‹æµ‹è¯•
```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•
./tests/run_tests.sh unit

# åªè¿è¡Œé›†æˆæµ‹è¯•
./tests/run_tests.sh integration

# è¿è¡Œè¦†ç›–ç‡æŠ¥å‘Š
./tests/run_tests.sh coverage

# è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥
./tests/run_tests.sh quality
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
./tests/run_tests.sh test tests/unit/database/test_interface.py

# è¿è¡Œç‰¹å®šæ¨¡å—çš„æ‰€æœ‰æµ‹è¯•
./tests/run_tests.sh test tests/unit/agent/
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

- **æ•´ä½“è¦†ç›–ç‡**: â‰¥ 80%
- **åˆ†æ”¯è¦†ç›–ç‡**: â‰¥ 75%
- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: â‰¥ 85%
- **é›†æˆæµ‹è¯•è¦†ç›–ç‡**: â‰¥ 70%

## ğŸ” ä»£ç è´¨é‡æ ‡å‡†

### ç±»å‹æ£€æŸ¥
- **Pyright**: é›¶é”™è¯¯ï¼Œé›¶è­¦å‘Š

### ä»£ç è´¨é‡
- **Pylint**: è¯„åˆ† â‰¥ 8.0/10
- å…³é”®é”™è¯¯å¿…é¡»ä¿®å¤
- è­¦å‘Šåº”è¯„ä¼°å¹¶å¤„ç†

### æµ‹è¯•éš”ç¦»
- æ¯ä¸ªæµ‹è¯•æ–¹æ³•ç‹¬ç«‹è¿è¡Œ
- æµ‹è¯•æ•°æ®ä¸ç›¸äº’æ±¡æŸ“
- ä½¿ç”¨Mockå¯¹è±¡éš”ç¦»å¤–éƒ¨ä¾èµ–

## ğŸ§ª æµ‹è¯•è®¾è®¡åŸåˆ™

### åŠŸèƒ½éªŒè¯ä¼˜å…ˆ
- ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
- ä¸è¿›è¡Œæ€§èƒ½æµ‹è¯•ã€è´Ÿè½½æµ‹è¯•æˆ–å¹¶å‘æµ‹è¯•
- ç¡®ä¿ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§

### æµ‹è¯•éš”ç¦»æœºåˆ¶
- **ç¯å¢ƒéš”ç¦»**: æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•ç¯å¢ƒ
- **æ•°æ®éš”ç¦»**: æµ‹è¯•æ•°æ®ä¸ç›¸äº’æ±¡æŸ“
- **çŠ¶æ€éš”ç¦»**: æµ‹è¯•çŠ¶æ€åœ¨æµ‹è¯•é—´å®Œå…¨é‡ç½®

### Mockä½¿ç”¨åŸåˆ™
- ä½¿ç”¨Mockå¯¹è±¡éš”ç¦»æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œç­‰å¤–éƒ¨ä¾èµ–
- éªŒè¯äº¤äº’è¡Œä¸ºè€Œéå…·ä½“å®ç°
- é¿å…è¿‡åº¦Mockï¼Œä¿æŒæµ‹è¯•çš„çœŸå®æ€§

## ğŸ“‹ æµ‹è¯•åˆ†ç±»

### å•å…ƒæµ‹è¯• (tests/unit/)
**è¦†ç›–æ¨¡å—**:
- âœ… `core/agent` - Agentæ ¸å¿ƒåŠŸèƒ½
- âœ… `core/context` - ä¸Šä¸‹æ–‡ç®¡ç†
- âœ… `core/middleware` - ä¸­é—´ä»¶ç³»ç»Ÿ
- âœ… `core/scheduler` - ä»»åŠ¡è°ƒåº¦
- âœ… `core/state_machine` - çŠ¶æ€æœº
- âœ… `database/` - æ•°æ®åº“æ¥å£å’Œå®ç°
- âœ… `llm/` - LLMæ¥å£
- âœ… `model/` - æ•°æ®æ¨¡å‹
- âœ… `terminal/` - ç»ˆç«¯åŠŸèƒ½

### é›†æˆæµ‹è¯• (tests/integration/)
**è¦†ç›–æ¨¡å—**:
- âœ… `database/` - æ•°æ®åº“é›†æˆæµ‹è¯•

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. **åˆ›å»ºæµ‹è¯•æ–‡ä»¶**:
   ```bash
   # åœ¨é€‚å½“çš„ç›®å½•ä¸‹åˆ›å»ºæµ‹è¯•æ–‡ä»¶
   touch tests/unit/your_module/test_new_feature.py
   ```

2. **ç¼–å†™æµ‹è¯•ç±»**:
   ```python
   import unittest

   class TestNewFeature(unittest.TestCase):
       def setUp(self) -> None:
           # æµ‹è¯•å‰å‡†å¤‡
           pass

       def test_basic_functionality(self) -> None:
           # åŸºæœ¬åŠŸèƒ½æµ‹è¯•
           pass

       def test_edge_cases(self) -> None:
           # è¾¹ç•Œæƒ…å†µæµ‹è¯•
           pass
   ```

3. **è¿è¡Œæµ‹è¯•**:
   ```bash
   ./tests/run_tests.sh test tests/unit/your_module/test_new_feature.py
   ```

### æµ‹è¯•å‘½åè§„èŒƒ

- **æµ‹è¯•æ–‡ä»¶**: `test_*.py`
- **æµ‹è¯•ç±»**: `Test*`
- **æµ‹è¯•æ–¹æ³•**: `test_*`

### æµ‹è¯•æ–‡æ¡£è¦æ±‚

æ¯ä¸ªæµ‹è¯•æ–¹æ³•éƒ½åº”åŒ…å«ï¼š
- æ¸…æ™°çš„æµ‹è¯•ç›®çš„æè¿°
- æµ‹è¯•æ­¥éª¤è¯´æ˜
- é¢„æœŸç»“æœéªŒè¯

## ğŸ”§ ç¯å¢ƒé…ç½®

### ä¾èµ–å®‰è£…
```bash
./tests/run_tests.sh install
```

### Pythonç¯å¢ƒ
- **æ¨è**: Python 3.12+
- **åŒ…ç®¡ç†**: ä¼˜å…ˆä½¿ç”¨ `uv`
- **è™šæ‹Ÿç¯å¢ƒ**: è‡ªåŠ¨æ£€æµ‹å’Œé…ç½®

## ğŸ“ˆ æŒç»­é›†æˆ

æµ‹è¯•è„šæœ¬è®¾è®¡ä¸ºä¸CI/CDæµæ°´çº¿å…¼å®¹ï¼š

```yaml
# .github/workflows/test.yml ç¤ºä¾‹
- name: Run Tests
  run: ./tests/run_tests.sh all
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å¯¼å…¥é”™è¯¯**:
   ```bash
   # ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
   cd /path/to/project
   ./tests/run_tests.sh all
   ```

2. **ä¾èµ–é—®é¢˜**:
   ```bash
   # é‡æ–°å®‰è£…ä¾èµ–
   ./tests/run_tests.sh install
   ```

3. **æƒé™é—®é¢˜**:
   ```bash
   # æ·»åŠ æ‰§è¡Œæƒé™
   chmod +x tests/run_tests.sh
   ```

### è°ƒè¯•æŠ€å·§

1. **è¯¦ç»†è¾“å‡º**:
   ```bash
   ./tests/run_tests.sh test tests/unit/your_test.py -v
   ```

2. **å•ç‹¬è¿è¡Œ**:
   ```bash
   uv run python -m pytest tests/unit/your_test.py -v -s
   ```

3. **è¦†ç›–ç‡è¯¦æƒ…**:
   ```bash
   ./tests/run_tests.sh coverage
   # æŸ¥çœ‹HTMLæŠ¥å‘Š: open htmlcov/index.html
   ```

## ğŸ“ è´¡çŒ®æŒ‡å—

### æäº¤å‰æ£€æŸ¥

åœ¨æäº¤ä»£ç å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. âœ… æ‰€æœ‰æ–°åŠŸèƒ½éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•
2. âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°è¦æ±‚
3. âœ… ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡
4. âœ… è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ï¼š

```bash
./tests/run_tests.sh all
```

### æŠ¥å‘Šé—®é¢˜

å¦‚æœé‡åˆ°æµ‹è¯•ç›¸å…³é—®é¢˜ï¼Œè¯·ï¼š

1. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
2. è¯´æ˜å¤ç°æ­¥éª¤
3. åŒ…å«ç¯å¢ƒä¿¡æ¯ï¼ˆPythonç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿç­‰ï¼‰

---

**æœ€åæ›´æ–°**: 2024-12-09
**ç»´æŠ¤è€…**: é¡¹ç›®å›¢é˜Ÿ